<style>
    .tim-screenshot {
        width: 80%;
        margin: 0 auto;
        border: 1px solid #DF7D3C;
    }
</style>

Prerequisites:
<ul>
    <li>Be familiar with Page Parameters</li><li>Be familiar with how to configure a Dynamic Data Block</li>
    <li>Be familiar with SQL</li>
</ul>
<h2>What</h2>
<p>This recipe showcases the possibility of using two Dynamic Data Blocks in one page, rather than having two separate pages with one Dynamic Data Block each.</p>
<p style="text-align: center;"><img src="/Content/RockExternal/Users/tim.seo/onepage-twodynamicdata.gif" style="width: 80%; margin: 0 auto; border: 2px solid #DF7D3C;" alt="onepage-twodynamicdata.gif"><br></p>
<h2>Why</h2>
<p>I am not saying that we should apply this to all scenarios where currently there are two related pages with a Dynamic Data Block each.</p>
<p>I am sharing this recipe because, in some situations, it might be more helpful to have a single page with two Dynamic Data Blocks.</p>
<p>For example, situations in which a user might prefer to keep open the set of results from the first Dynamic Data Block, and then dynamically drill-down into various rows of this first Dynamic Data Block, without navigating to a child page.</p>
<h2>How (general concept)</h2>
<p>This is a <a href="https://youtu.be/8ETKNiS5IyM">12-min 27-sec Youtube video</a>, for those who might prefer a video format.</p>
In a Page, configure three blocks:
<ol>
    <li>Page Parameter Block</li>
    <ul>
        <li>This Block will contain Page Parameter(s) necessary for the first Dynamic Data Block to run its SQL query</li>
    </ul>
    <li>Dynamic Data Block</li>
    <ul>
        <li>Any columns referenced in the WHERE clause of this Block's SQL query must also be included on the SELECT clause.<br></li>
        <li>In the <b>Selection URL</b> configuration of this Dynamic Data Block, (1) re-build the URL of the current page, (2) include the PageParameters that were necessary for this Dynamic Data Block's SQL Query, and (3) include the PageParameters that will be necessary for the second Dynamic Data Block's SQL Query</li>
    </ul>
    <li>Dynamic Data Block</li>
</ol>
<h2>How (specific example, step-by-step)</h2>
<p>You can follow this example on the <a href="https://rock.rocksolidchurchdemo.com/page/3?returnurl=%252f" target="_blank">Rock Demo Site</a>. <font color="#9c9c94">(Just in case the demo config changes: As of 22-DEC-2023, the demo Site has a GroupType called 'Small Group' and this GroupType has a Group Attribute called 'Topic', which is a Defined Value)</font>. Also, if you're following along these steps, and you notice there's a setting I don't mention, it's safe to assume I kept the default settings for that unmentioned setting.</p>
<p>With all those disclaimers out of the way, let's say you want to show a filtered list of <font color="#ff9c00"><b>Groups</b></font> on the first Dynamic Data Block, and you want to show a list of <font color="#ff9c00"><b>Group Members</b></font> on the second Dynamic Data Block.</p>
<p>Let's also say that the first Dynamic Data Block must show a list of Groups <font color="#9c9c94">(of GroupType = 'Small Group')</font> filtered by a Group Attribute called 'Topic'.</p>
<h3>Steps:</h3>
<ol>
    <li>Configure a page where you want to do this. You could choose any Layout you want, but for me, I chose the 'Full Width' Layout.<br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_4.16.41%E2%80%AFPM.png" alt="screenshot_creating_a_page.png" class="tim-screenshot"></div><br></li>
    <li>In the <font color="#9c00ff">Main Zone</font> of this new page, add a <b>Page Parameter Filter</b> Block.<br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_4.27.15%E2%80%AFPM.png" alt="screenshot_creating_a_PageParameterFilter_block" class="tim-screenshot"></div><br></li>
    <li>Let's open the Block Configurations for this <b>Page Parameter Filter</b> Block. <br>You can do whatever you see fit for the <u>Block Title Settings</u> and the <u>Filter Settings</u>, but in the <u>Filters</u>, we'll add whatever we want to parametrize in the SQL Query of the first Dynamic Data Block. <br>In the context of this example scenario, we will have one Filter for 'Small Group Topic'<br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_4.35.29%E2%80%AFPM.png" alt="screenshot_blockconfiguration_PageParameterFilter_block.png" class="tim-screenshot"></div><br></li>
    <li>I chose to <b>name</b> it "Small Group Topic" and i chose the <b>key</b> to be "topic". <br>When parametrizing things, I like choosing the 'Single-Select' <b>Field Type</b> and use SQL for the <b>Values</b>.<br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_5.15.26%E2%80%AFPM.png" alt="screenshot_filter1_PageParameterFilter_block.png" class="tim-screenshot"></div>This is the SQL Query I used in this example:<br><pre class="">SELECT dv.[Guid] AS 'Value', dv.[Value] AS 'Text' FROM [DefinedValue] dv WHERE dv.DefinedTypeId = 52;</pre><br></li>
    <li>In <font color="#9c00ff">Section A</font> of this page, add a <b>Dynamic Data</b> Block. I named it "Dynamic Data 1" because I know there will be two of these in this page.<br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_5.25.22%E2%80%AFPM.png" alt="screenshot_creating_a_DynamicData_block.png" class="tim-screenshot"></div><br></li>
    <li>Let's open the Block Configurations for this <b>Dynamic Data</b> Block. <br> Since we want to show a list of Groups filtered by Group Attribute, we will create a Lava Variable and store the Page Parameter, 'topic' <font color="#9c9c94">(it's the <b>key</b> that we chose in Step#4, and it's case-sensitive)</font>, and we'll use this Lava Variable in the WHERE clause of our SQL Query afterwards.<br><pre class=""> assign var_topic = PageParameter.topic | SanitizeSql </pre>Because our WHERE clause will have a variable, and because this variable begins as blank, the SQL query will err. <br>In order to prevent that error, we can wrap our whole SQL Query inside an IF statement, so that the SQL query will only run if our variable is not blank. <br><pre class=""> if var_topic != empty 
    OUR-SQL-QUERY-WILL-BE-HERE
 endif</pre><div><img src="/Content/RockExternal/Users/tim.seo/dynamicdata1_query.png" alt="screenshot_query_for_first_DynamicData_block.png" class="tim-screenshot"></div>This is what the Lava and SQL look like, you can copy+paste this (or get adapt it to your needs) into the <b>Query</b> field: <br><font color="#000000" style="background-color: rgb(255, 255, 0);">If the code embedded below does not show line numbers, refresh this page and the formatting will be fixed</font>.<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-06-DynamicData.lava%23L1-L22&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on"></script>Notice that <font color="#ff0000">GroupId</font> and <font color="#ff0000">var1</font> are included in the <b>Query</b> but they are also hidden from view. <br><br>Notice also that <font color="#ff0000">var1</font> is both in the WHERE clause and also the SELECT clause; (1) It's in the WHERE clause because that's how we filter our results, and (2) it's in the SELECT clause because that's how we will be able to pass this value into the <b>Selection URL</b> field later. <br><br>The <b>Selection URL</b> is the URL to which your user will be redirected when they click one of the rows in this <b>Dynamic Data</b> Block. Rather than using the Selection URL to navigate to a different page, we will navigate to the current page, and add some Page Parameter(s) that will enable the second <b>Dynamic Data</b> Block. <br><br>It's not included in my screenshots, but the current page was page/2760. So our <b>Selection URL</b> will begin with this page route: <br><pre class=""> https://rock.rocksolidchurchdemo.com/page/2760</pre>If we redirect to this page, and the <font color="#ff0000">PageParameter.topic</font> is empty, the first <b>Dynamic Data</b> Block will not show anything. We can instead create the illusion that the first <b>Dynamic Data</b> Block remained open by simply including the <font color="#ff0000">PageParameter.topic</font> in this Selection URL, like this: <br><pre class=""> https://rock.rocksolidchurchdemo.com/page/2760?topic={var1}</pre>We must also include the Page Parameter that will enable the second <b>Dynamic Data</b> Block. We haven't configured this yet, but the second <b>Dynamic Data</b> Block will show a list of <font color="#ff9c00"><b>Group Members</b></font>, and in order to query a list of <font color="#ff9c00"><b>Group Members</b></font>, we need <font color="#ff0000">GroupId</font>; therefore we will include the <font color="#ff0000">GroupId</font> in this Selection URL like this: <br><pre class=""> https://rock.rocksolidchurchdemo.com/page/2760?topic={var1}&amp;GroupId={GroupId}</pre>This is what it looks like so far: <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.20.32%E2%80%AFPM.png" alt="screenshot_selectionURL_for_first_DynamicData_block.png" class="tim-screenshot"></div><br></li>
    <li>Before we configure the second <b>Dynamic Data</b> Block, let's also make a change in the <b>Block Properties</b> of this first <b>Dynamic Data</b> Block. <br>From the <b>Block Properties</b>, go to the 'Advanced Settings' tab. <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.26.36%E2%80%AFPM.png" alt="screenshot_DynamicData_Block_BlockProperties.png" class="tim-screenshot"></div>Then add these snippets to the <b>Pre-HTML</b> and <b>Post-HTML</b> fields: <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.33.18%E2%80%AFPM.png" alt="screenshot_PreHTML_and_PostHTML_for_first_DynamicData_block.png" class="tim-screenshot"></div>This is the <b>Pre-HTML</b>: <script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-07-AdvancedSettings.html%23L1&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showCopy=on"></script> And this is the <b>Post-HTML</b>: <script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-07-AdvancedSettings.html%23L2&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showCopy=on"></script> You might need to reload the page after saving, but the end-result is that your first <b>Dynamic Data</b> Block will look like a left sidebar like this: <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.36.21%E2%80%AFPM.png" alt="screenshot_first_DynamicData_block_looks_like_a_leftsidebar.png" class="tim-screenshot"></div><br></li>
    <li>In <font color="#9c00ff">Section A</font> of this page, let's add the second <b>Dynamic Data</b> Block. I named it "Dynamic Data 2" because I am very skilled at naming things. <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.40.35%E2%80%AFPM.png" alt="screenshot_DynamicData_Block_2.png" class="tim-screenshot"></div><br></li>
    <li>In the <b>Block Configurations</b> of this second <b>Dynamic Data</b> Block, we will do a similar <u>Query Logic</u>; the only difference being that now we are using the <font color="#ff0000">GroupId</font> from the Page Parameter, and querying <font color="#ff9c00"><b>Group Members</b></font>. <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.47.19%E2%80%AFPM.png" alt="screenshot_DynamicData_Block_2_BlockConfigurations.png" class="tim-screenshot"></div>This is the Query that I used: <br><font color="#000000" style="background-color: rgb(255, 255, 0);">If the code embedded below does not show line numbers, refresh this page and the formatting will be fixed</font>. <script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-09-DynamicData.lava%23L1-L51&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on"></script></li>
    <li>And just like we did with the first <b>Dynamic Data</b> Block, we can add <b>Pre-HTML</b> and <b>Post-HTML</b> in the 'Advanced Settings' of the <b>Block Properties</b>: <br><div><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.50.10%E2%80%AFPM.png" alt="screenshot_DynamicData_Block_2_AdvancedSettings.png" class="tim-screenshot"></div>This is the <b>Pre-HTML</b>: <script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-10-AdvancedSettings.html%23L1&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showCopy=on"></script> And this is the <b>Post-HTML</b>: <script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FValleyRealLife%2Frockrms-recipes%2Fblob%2F2877914cfe9c6f7f9be41da3b5a04fb79b9390a6%2Frecipes%2Frecipe-415%2FStep-10-AdvancedSettings.html%23L2&amp;style=default&amp;type=code&amp;showBorder=on&amp;showLineNumbers=on&amp;showCopy=on"></script></li>
</ol>
<p>And that's all the steps! I didn't plan for it to be 10 steps, but I like the fact it's an even 10</p>
<h2>Gotchas</h2>
<p>The keen among you may have noticed that, if you followed my steps, the "Reset Filters" button in the <b>Page Parameter Filter</b> Block will clear the first <b>Dynamic Data</b> Block, but not the second one.</p>
<p>That's because, for some reason, the <b>Page Parameter Filter</b> Block's "Reset Filters" button can only clear the Filters that have been added under the <u>Filters</u> of its <b>Block Configuration</b>. Therefore, even if we are not expecting our users to use the <b>Page Parameter Filter</b> Block to add/remove <font color="#ff0000">GroupId</font> values, we should add <font color="#ff0000">GroupId</font> as one of the Filters in the <b>Page Parameter Filter</b> Block.
</p><ul>
    <li>In my experience, <b>Field Type</b> can be 'Text', and it will work as intended. <br><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.53.08%E2%80%AFPM.png" alt="screenshot_PageParameter_2.png" class="tim-screenshot"><br><img src="/Content/RockExternal/Users/tim.seo/Screenshot_2023-12-21_at_7.53.22%E2%80%AFPM.png" alt="screenshot_PageParameter_3.png" class="tim-screenshot"></li>
</ul><p></p>
<h2>Notes:</h2>
<a href="https://github.com/ValleyRealLife/rockrms-recipes/tree/main/recipes/recipe-415">Code snippets in Github</a>